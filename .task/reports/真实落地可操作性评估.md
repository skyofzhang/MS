# 真实落地可操作性评估

**评估范围**：知识库架构 + N8N 流程 + Claude 当前代码状态（已修复编译报错）  
**评估时间**：2026-02-06  
**结论先行**：**可落地，但需补全 2～3 处关键链路与约定**，整体可操作性约 **75%～80%**。

---

## 一、知识库架构与代码的匹配度

### 1.1 知识库侧

- **V3.0 总控**：项目 MS、Unity 2022.3.47f1c1、竖屏 1080×1920、Phase 5 完成、约 85 个文件级实现。
- **AI 开发知识库**：§1 常量、§2 RULE-RES 资源路径、§3 系统调用、§4 数值/技能、§5 物理层、§6 完成检查；WHEN-DO-VERIFY 指令，面向 AI 可执行。

### 1.2 代码侧（Claude 刚修完报错）

- **脚本结构**：Core / Data / Gameplay / Combat / Systems / UI / Utils / Editor / Test 齐全，与知识库分层一致。
- **资源路径**：ResourceLoader 与 RULE-RES 路径一致；Models/Sprites/Audio 目录存在且命名符合 R01 清单。
- **核心系统**：SaveSystem、CombatSystem、MonsterSpawner、UIManager、场景 MainMenu/StageSelect/GameScene 均已实现；玩家属性与技能数值与 §4 一致。
- **编译**：当前无编译错误（你已确认 Claude 刚修复），说明知识库驱动下的代码处于「可编译、可跑」状态。

### 1.3 小结

知识库与代码的**真实匹配度**与《知识库V3.0与MoShou项目对照分析报告》一致：约 **85%～90%**。缺口主要在「运行时用预制体加载玩家」「渲染管线表述」「物理 Layer 显式配置」，不影响当前闭环跑通。**知识库架构对落地的支撑是足够的**。

---

## 二、N8N 流程与当前协议

### 2.1 已就绪部分

| 组件 | 状态 | 说明 |
|------|------|------|
| **PROTOCOL.json** | ✅ | 状态机、.task 文件职责、Git 标签、NWF 列表定义清晰 |
| **workflow_state.json** | ✅ | 当前 phase=`cursor_execute`，current_task=MS-009-BUILD，历史与下一阶段明确 |
| **current_task / task_result** | ✅ | Claude 写任务、Cursor 写结果，MS-009 已完成并写入了 implementation_done |
| **BuildErrorReporter** | ✅ | 编译错误 → 写 `.task/build_errors.json` + POST `http://43.161.249.54:5678/webhook/build-error` |
| **NWF-05** | ✅ 协议标注 active | 触发条件：`/webhook/build-error`；项目内无 NWF-05 节点定义，实际 n8n 上是否接好需在服务器确认 |
| **NWF-01/02/03** | ✅ 协议标注 active | Notion 监听、Git 事件、状态记录 |

### 2.2 与「编译错误 → 修复」的闭环

- **Unity → n8n**：有。`BuildErrorReporter` 在编译失败时写本地 JSON 并 POST 到 n8n，Claude 或后续流程可依赖。
- **n8n → Claude**：**未在仓库内显式定义**。NWF-05 收到 payload 后应至少做其一：
  - 写 `ask_claude.json`（或等价）把错误摘要给 Claude，或
  - 更新 `workflow_state.json` / 写入一条「修复编译错误」类任务到 `current_task.json`，再由人类或定时触发 Claude。
- 若 n8n 上 NWF-05 仅「记录日志」而未写入 .task 或通知 Claude，则**编译错误闭环差最后一环**。

### 2.3 与「需求 → 开发 → 验收」的闭环

- **需求入口**：Notion → NWF-01 检测 → 需有人或调度**触发 Claude**（例如人类说「开始」、或 cron 调 Claude API）。触发方式在文档中有约定，但非全自动。
- **任务执行**：Claude 写 `current_task.json` → Cursor 读并执行 → 写 `task_result.json` → Claude 验收（读截图/结果）。**当前实际跑通**（MS-009 即此路径）。
- **打包与人类验收**：MS-009-BUILD 已定义为自动执行 PowerShell（关 Unity、批处理打包、查 APK），输出与 on_success/on_failure 明确；人类验收在 STATE_MACHINE 中为 human_review。

因此：**需求→任务→执行→结果→打包** 的链路在协议与当前任务里是通的；**编译错误→自动修复** 是否通，取决于 n8n 上 NWF-05 的 downstream 配置。

---

## 三、两套架构文档的差异与建议

- **STATE_MACHINE + PROTOCOL**：**Cursor 在环内**。cursor_execute 阶段由 Cursor 改 Unity 工程、写 task_result，build_apk 可由 Cursor 或脚本执行。
- **WORKFLOW_CORRECTED + ARCHITECTURE_V1.4**：**Cursor 不在环内**，Claude 通过 Unity CLI + SceneModifier 等独立完成。

当前**真实运行的是「Cursor 在环内」**：MS-009 由 Cursor 改 MainMenu.unity、写 task_result；SceneModifier 存在且支持 `.execute_trigger` 与 AddStartButton，但 MS-009 并未走「Claude 写 trigger → Unity 执行 SceneModifier」这条线。

**建议**：在「真实落地」层面明确采用**混合模型**并写进 CLAUDE_CONTEXT 或 PROTOCOL：

- **Claude**：策划、拆任务、写 current_task、验收 task_result、更新 workflow_state、必要时调 Unity CLI（打包/SceneModifier）。
- **Cursor**：在 cursor_execute 阶段按 current_task 改代码与场景，写 task_result（并可选提交 [TASK_RESULT]）。
- **n8n**：NWF-01 拉需求、NWF-02/03 记状态、NWF-05 收编译错误并**写入 .task 或通知 Claude**。

这样既不否定「Claude 可独立用 CLI」的能力，也承认当前人机协作中 Cursor 承担执行，可操作性更清晰。

---

## 四、真实落地可操作性评分与缺口

### 4.1 评分（主观）

| 维度 | 得分 | 说明 |
|------|------|------|
| 知识库 → 代码 | 85% | 路径/数值/系统一致；差运行时加载与管线表述 |
| 协议与 .task 设计 | 90% | 状态机、任务/结果、标签定义完整且已在用 |
| N8N 与 Unity 衔接 | 70% | 错误上报已接；NWF-05 下游未在库内可见 |
| 需求→任务→执行→验收 | 85% | MS-009 全链路跑通；需求触发仍依赖人/调度 |
| 编译错误→修复闭环 | 60% | Unity→n8n 有；n8n→Claude 需在 n8n 上确认 |
| **整体可操作性** | **75%～80%** | 能落地；补 2～3 处即可到 85%+ |

### 4.2 必须补全的 2～3 处

1. **NWF-05 下游**  
   在 n8n 上确认：收到 `/webhook/build-error` 后，是否写 `.task/build_errors.json` 或 `ask_claude.json`（或等价的「待修复」任务），并确保 Claude 或人类能据此触发修复。若尚未配置，建议增加「写 .task 或调 Claude API」的节点。

2. **需求触发的可重复性**  
   明确「谁在何时触发 Claude」：人类在对话中说「开始」、或 n8n 在 NWF-01 后调 Claude API、或定时任务读 workflow_state 后调 Claude。任选一种写进运维/上下文文档，避免依赖口头约定。

3. **架构文档二选一或显式混合**  
   在 CLAUDE_CONTEXT 或 README 中写清：当前采用「Claude 拆任务 + Cursor 执行 + .task 通信」的混合模型，并注明 SceneModifier/CLI 为可选自动化路径。减少「到底听 STATE_MACHINE 还是 WORKFLOW_CORRECTED」的歧义。

---

## 五、结论与一句话建议

- **知识库架构**：能支撑当前代码与流程，真实匹配度高，无需大改。  
- **N8N 流程**：事件与 webhook 已接，状态与任务流在用；**编译错误闭环**依赖 n8n 上 NWF-05 的 downstream，需在服务器侧确认或补全。  
- **Claude 代码状态**：已修复编译报错，脚本与资源结构完整，与知识库一致，**具备可落地状态**。

**一句话**：在「知识库 + N8N + 当前代码」三者结合下，**真实落地可操作性约 75%～80%**；补全「NWF-05 下游」「需求触发约定」「架构文档统一」后，可稳定提升到 **85%+** 并长期复用。
